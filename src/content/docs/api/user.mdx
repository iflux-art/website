---
title: 用户认证API接口
description: 用户认证API接口详细说明
date: 2025-08-29
category: API
tags:
  - API
  - 认证
  - 用户管理
---

# 用户认证API接口

用户认证API接口提供用户注册、登录、会话管理等认证相关功能。

## 基础信息

### 基础URL

```
/api/auth
```

### 认证要求

大部分接口为公开访问，无需认证。受保护的资源需要有效的认证令牌。

## 接口列表

### 1. 获取认证状态

```
GET /api/auth/status
```

获取当前用户的认证状态。

#### 响应示例

```json
{
  "success": true,
  "data": {
    "isAuthenticated": true,
    "user": {
      "id": "user_2XbD3n8vQ9aB2cD4eF6gH8iJ0kL",
      "name": "张三",
      "email": "zhangsan@example.com",
      "imageUrl": "https://example.com/avatar.jpg",
      "createdAt": "2025-08-29T12:00:00Z"
    }
  },
  "timestamp": "2025-08-29T12:00:00Z"
}
```

### 2. 获取用户信息

```
GET /api/auth/user
```

获取当前用户的详细信息。

#### 响应示例

```json
{
  "success": true,
  "data": {
    "id": "user_2XbD3n8vQ9aB2cD4eF6gH8iJ0kL",
    "name": "张三",
    "email": "zhangsan@example.com",
    "imageUrl": "https://example.com/avatar.jpg",
    "createdAt": "2025-08-29T12:00:00Z",
    "lastSignInAt": "2025-08-29T12:00:00Z",
    "providers": ["github", "google"]
  },
  "timestamp": "2025-08-29T12:00:00Z"
}
```

### 3. 用户登出

```
POST /api/auth/logout
```

用户登出，清除当前会话。

#### 请求体

```json
{
  "redirectUrl": "/login" // 可选，登出后重定向地址
}
```

#### 响应示例

```json
{
  "success": true,
  "data": {
    "message": "登出成功"
  },
  "timestamp": "2025-08-29T12:00:00Z"
}
```

## 数据结构

### 用户基本信息

```typescript
interface User {
  id: string;
  name: string;
  email: string;
  imageUrl?: string;
  createdAt: string; // ISO 8601格式
}
```

### 用户详细信息

```typescript
interface UserDetail extends User {
  lastSignInAt?: string; // ISO 8601格式
  providers: string[]; // 认证提供商列表
}
```

### 认证状态

```typescript
interface AuthStatus {
  isAuthenticated: boolean;
  user?: User;
}
```

## 错误响应

### 401 - 未授权

```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "未授权访问"
  },
  "timestamp": "2025-08-29T12:00:00Z"
}
```

### 400 - 参数错误

```json
{
  "success": false,
  "error": {
    "code": "INVALID_PARAMETERS",
    "message": "参数验证失败",
    "details": {
      "redirectUrl": "重定向地址格式不正确"
    }
  },
  "timestamp": "2025-08-29T12:00:00Z"
}
```

## 使用示例

### JavaScript (fetch)

```javascript
// 获取认证状态
async function getAuthStatus() {
  try {
    const response = await fetch('/api/auth/status');
    const result = await response.json();
    
    if (result.success) {
      if (result.data.isAuthenticated) {
        console.log('用户已登录:', result.data.user);
      } else {
        console.log('用户未登录');
      }
    } else {
      console.error('获取失败:', result.error.message);
    }
  } catch (error) {
    console.error('网络错误:', error);
  }
}

// 获取用户信息
async function getUserInfo() {
  try {
    const response = await fetch('/api/auth/user');
    const result = await response.json();
    
    if (result.success) {
      console.log('用户信息:', result.data);
    } else {
      console.error('获取失败:', result.error.message);
    }
  } catch (error) {
    console.error('网络错误:', error);
  }
}

// 用户登出
async function logout(redirectUrl = '/login') {
  try {
    const response = await fetch('/api/auth/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ redirectUrl })
    });
    const result = await response.json();
    
    if (result.success) {
      console.log('登出成功:', result.data.message);
      // 执行页面跳转
      if (redirectUrl) {
        window.location.href = redirectUrl;
      }
    } else {
      console.error('登出失败:', result.error.message);
    }
  } catch (error) {
    console.error('网络错误:', error);
  }
}
```

### Python (requests)

```python
import requests

# 获取认证状态
def get_auth_status():
    try:
        response = requests.get('https://your-domain.com/api/auth/status')
        result = response.json()
        
        if result['success']:
            if result['data']['isAuthenticated']:
                print('用户已登录:', result['data']['user'])
            else:
                print('用户未登录')
        else:
            print('获取失败:', result['error']['message'])
    except Exception as error:
        print('网络错误:', error)

# 获取用户信息
def get_user_info():
    try:
        response = requests.get('https://your-domain.com/api/auth/user')
        result = response.json()
        
        if result['success']:
            print('用户信息:', result['data'])
        else:
            print('获取失败:', result['error']['message'])
    except Exception as error:
        print('网络错误:', error)

# 用户登出
def logout(redirect_url='/login'):
    try:
        response = requests.post(
            'https://your-domain.com/api/auth/logout',
            json={'redirectUrl': redirect_url}
        )
        result = response.json()
        
        if result['success']:
            print('登出成功:', result['data']['message'])
        else:
            print('登出失败:', result['error']['message'])
    except Exception as error:
        print('网络错误:', error)
```

## 认证机制

### 1. 会话认证

用户登录后，系统会创建一个安全的会话，通过Cookie维护认证状态。

### 2. 令牌认证

对于API请求，可以使用认证令牌进行身份验证：

```
Authorization: Bearer <token>
```

### 3. CSRF保护

所有修改数据的请求都需要CSRF令牌保护，防止跨站请求伪造攻击。

## 安全措施

### 1. 数据安全

- 敏感信息保护，避免在客户端暴露
- 使用加密传输（HTTPS）
- 定期轮换会话密钥

### 2. 会话安全

- 合理设置会话过期时间
- 支持会话注销功能
- 多设备会话管理

### 3. 速率限制

- 登录尝试速率限制
- 防止暴力破解攻击
- 异常行为监控

## 更新日志

### v1.0.0 (2025-08-29)

- 初始化用户认证API接口
- 实现认证状态、用户信息、登出接口

## 注意事项

1. 所有时间字段使用ISO 8601格式
2. 用户头像URL可能来自第三方服务
3. 认证状态接口为公开访问，但用户信息接口需要认证
4. 登出接口会清除当前用户的会话信息
5. 建议在前端实现适当的错误处理和用户提示

通过这些API接口，开发者可以轻松地在自己的应用中集成用户认证功能，管理用户会话和权限。