---
title: 性能优化指南
description: 了解如何优化页面加载速度，提高用户体验
---

# 性能优化指南

本文档介绍了如何优化页面加载速度，提高用户体验。

## 影响页面加载速度的因素

以下是影响页面加载速度的主要因素：

### 1. JavaScript 包体积

大型 JavaScript 库会增加初始加载时间，特别是：

- **大型动画库**：JavaScript 动画库通常体积较大，建议使用 CSS 动画替代
- **MDX 相关库**：处理 MDX 内容的库集合
- **Radix UI 组件**：UI 组件库

### 2. 图片优化

未优化的图片会显著影响页面加载速度：

- **大尺寸图片**：文件体积大，加载慢
- **未压缩图片**：文件体积大，加载慢
- **未使用现代格式**：WebP、AVIF 等现代格式比 JPEG、PNG 更小

### 3. CSS 优化

未优化的 CSS 会影响页面渲染速度：

- **未使用 CSS 模块**：全局 CSS 会导致样式冲突
- **未使用 CSS-in-JS**：难以进行代码分割
- **未使用 Tailwind CSS 的 JIT 模式**：生成的 CSS 文件较大

### 4. 服务器组件和流式渲染

未使用服务器组件和流式渲染会影响页面加载速度：

- **客户端渲染**：需要等待 JavaScript 加载和执行
- **未使用流式渲染**：需要等待所有数据加载完成

## 优化策略

### 1. JavaScript 优化

#### 按需导入

使用动态导入工具 `dynamicImport` 按需导入组件：

```tsx
import { dynamicImport } from '@/lib/dynamic-import';

// 动态导入组件
const HeavyComponent = dynamicImport(() => import('@/components/heavy-component'));

// 使用
<HeavyComponent />;
```

#### 使用 CSS 动画替代 JavaScript 动画库

使用原生 CSS 动画和过渡效果，避免使用大型动画库：

```tsx
// 使用 CSS 类和过渡效果
<div className="opacity-0 animate-in fade-in duration-300 fill-mode-forwards">
  内容
</div>

// 使用 CSS 变量和计算
<div
  className="transition-all duration-300"
  style={{
    animationDelay: '200ms',
    transitionTimingFunction: 'cubic-bezier(0.22, 1, 0.36, 1)'
  }}
>
  内容
</div>
```

#### 按需导入 Lucide 图标

使用动态导入工具 `dynamicIcon` 按需导入 Lucide 图标：

```tsx
import { dynamicIcon } from '@/lib/dynamic-import';

// 动态导入 Home 图标
const HomeIcon = dynamicIcon('Home');

// 使用
<HomeIcon className="w-5 h-5" />;
```

### 2. 图片优化

#### 使用优化图片组件

使用 `OptimizedImage` 组件优化图片加载：

```tsx
import { OptimizedImage } from '@/components/ui/optimized-image';

// 基本用法
<OptimizedImage
  src="/image.jpg"
  alt="描述"
  width={800}
  height={600}
/>

// 关键图片（优先加载）
<OptimizedImage
  src="/hero.jpg"
  alt="Hero"
  width={1200}
  height={600}
  isHero
/>
```

#### 使用现代图片格式

Next.js 已配置为自动使用 WebP 和 AVIF 格式，无需额外配置。

#### 使用响应式图片

使用 `sizes` 属性指定响应式图片尺寸：

```tsx
<OptimizedImage
  src="/image.jpg"
  alt="描述"
  width={800}
  height={600}
  sizes="(max-width: 768px) 100vw, 50vw"
/>
```

### 3. 使用服务器组件

#### 创建服务器组件

创建不带 `'use client'` 指令的组件，自动成为服务器组件：

```tsx
// 服务器组件
import { db } from '@/lib/db';

export default async function ServerComponent() {
  // 在服务器上获取数据
  const data = await db.query('SELECT * FROM users');

  return (
    <div>
      {data.map(user => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

#### 使用流式渲染

使用 React 的 Suspense 和 streaming 功能：

```tsx
import { Suspense } from 'react';
import Loading from './loading';
import ServerComponent from './server-component';

export default function Page() {
  return (
    <div>
      <h1>页面标题</h1>
      <Suspense fallback={<Loading />}>
        <ServerComponent />
      </Suspense>
    </div>
  );
}
```

### 4. 缓存优化

#### 使用 ISR

使用 Next.js 的增量静态再生成 (ISR) 功能：

```tsx
export const revalidate = 60; // 每 60 秒重新验证

export default async function Page() {
  // ...
}
```

#### 使用缓存控制

使用 Next.js 的缓存控制功能：

```tsx
import { cache } from 'react';

// 缓存数据获取函数
const getData = cache(async () => {
  const res = await fetch('https://api.example.com/data');
  return res.json();
});

export default async function Page() {
  const data = await getData();
  // ...
}
```

## 性能检测工具

### 1. Lighthouse

使用 Chrome DevTools 中的 Lighthouse 工具检测页面性能：

1. 打开 Chrome DevTools
2. 切换到 Lighthouse 标签
3. 点击 "Generate report"

### 2. Web Vitals

使用 Web Vitals 库监测页面性能：

```tsx
import { useReportWebVitals } from 'next/web-vitals';

export function MyApp({ Component, pageProps }) {
  useReportWebVitals(metric => {
    console.log(metric);
  });

  return <Component {...pageProps} />;
}
```

### 3. Next.js Analytics

使用 Next.js Analytics 监测页面性能：

```tsx
// next.config.js
module.exports = {
  experimental: {
    webVitalsAttribution: ['CLS', 'LCP'],
  },
};
```

## 最佳实践

1. **使用服务器组件**：将数据获取和复杂逻辑移至服务器组件
2. **按需导入**：使用动态导入工具按需导入组件
3. **优化图片**：使用优化图片组件和现代图片格式
4. **使用缓存**：使用 ISR 和缓存控制功能
5. **监测性能**：使用性能检测工具监测页面性能

## 相关资源

- [Next.js 性能优化文档](https://nextjs.org/docs/advanced-features/performance)
- [React 性能优化文档](https://reactjs.org/docs/optimizing-performance.html)
- [Web Vitals](https://web.dev/vitals/)
- [Lighthouse](https://developers.google.com/web/tools/lighthouse)
