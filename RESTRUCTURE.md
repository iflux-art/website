# 项目重构指南：极致模块化

## 重构目标

本次重构的主要目标是实现项目的极致模块化，同时确保不影响项目的正常运行。具体目标包括：

1. **提高代码可维护性**：通过模块化结构，使代码更易于理解和维护
2. **提高代码可测试性**：通过清晰的模块边界，使代码更易于测试
3. **提高代码可扩展性**：通过松耦合的模块设计，使代码更易于扩展
4. **提高开发效率**：通过标准化的目录结构和命名约定，减少开发者的认知负担
5. **保持向后兼容**：确保重构不会破坏现有功能

## 重构范围

本次重构涵盖以下方面：

1. **组件结构**：将组件按照功能和职责划分为不同的模块
2. **状态管理**：将状态管理逻辑模块化，便于维护和测试
3. **钩子函数**：将钩子函数模块化，提高复用性
4. **工具函数**：将工具函数模块化，提高可维护性
5. **类型定义**：将类型定义模块化，提高可维护性

## 重构方法

本次重构采用渐进式重构策略，分阶段实施：

### 阶段 1：组件结构标准化

1. 创建组件目录结构标准化脚本
2. 为每个组件创建独立目录
3. 创建标准的导出文件
4. 更新导入路径

### 阶段 2：状态管理和钩子函数重构

1. 创建新的状态管理目录结构
2. 迁移现有状态管理逻辑
3. 创建新的钩子函数目录结构
4. 迁移现有钩子函数

### 阶段 3：工具函数和类型定义重构

1. 创建新的工具函数目录结构
2. 迁移现有工具函数
3. 创建新的类型定义目录结构
4. 迁移现有类型定义

### 阶段 4：验证和修复

1. 验证项目是否能正常构建
2. 修复可能的问题
3. 确保所有测试通过

## 重构后的目录结构

```
src/
  ├── app/                 # Next.js App Router 页面
  │   ├── [lang]/          # 多语言路由
  │   ├── layout.tsx       # 根布局
  │   └── globals.css      # 全局样式
  ├── components/          # 组件库
  │   ├── ui/              # 基础UI组件
  │   │   ├── button/      # 按钮组件
  │   │   │   ├── index.ts           # 导出文件
  │   │   │   ├── button.tsx         # 组件实现
  │   │   │   ├── button.types.ts    # 组件类型定义
  │   │   │   └── button.test.tsx    # 组件测试
  │   │   └── ...
  │   ├── features/        # 功能组件
  │   │   ├── blog/        # 博客相关组件
  │   │   │   ├── post-card/         # 文章卡片组件
  │   │   │   │   ├── index.ts
  │   │   │   │   ├── post-card.tsx
  │   │   │   │   ├── post-card.types.ts
  │   │   │   │   └── post-card.test.tsx
  │   │   │   └── ...
  │   │   └── ...
  │   └── layout/          # 布局组件
  │       ├── navbar/      # 导航栏组件
  │       │   ├── index.ts
  │       │   ├── navbar.tsx
  │       │   ├── navbar.types.ts
  │       │   └── navbar.test.tsx
  │       └── ...
  ├── store/               # 状态管理
  │   ├── theme/           # 主题状态
  │   │   ├── index.ts     # 导出文件
  │   │   ├── actions.ts   # 状态操作
  │   │   ├── selectors.ts # 状态选择器
  │   │   ├── types.ts     # 类型定义
  │   │   └── store.ts     # 状态存储
  │   └── ...
  ├── hooks/               # 钩子函数
  │   ├── ui/              # UI相关钩子
  │   │   ├── index.ts     # 导出文件
  │   │   ├── use-example.ts # 钩子实现
  │   │   └── use-example.test.ts # 钩子测试
  │   └── ...
  ├── lib/                 # 工具函数
  │   ├── string/          # 字符串处理
  │   │   ├── index.ts     # 导出文件
  │   │   ├── utils.ts     # 工具函数实现
  │   │   └── utils.test.ts # 工具函数测试
  │   └── ...
  ├── types/               # 类型定义
  │   ├── ui/              # UI相关类型
  │   │   ├── index.ts     # 导出文件
  │   │   └── types.ts     # 类型定义
  │   └── ...
  └── content/             # 内容数据
      ├── en/              # 英文内容
      └── zh/              # 中文内容
```

## 重构脚本

本次重构提供了以下脚本：

1. **restructure-project.js**：主脚本，协调整个重构过程
2. **component-restructure.js**：组件目录结构标准化脚本
3. **restructure-state-hooks.js**：状态管理和钩子函数重构脚本
4. **restructure-utils-types.js**：工具函数和类型定义重构脚本
5. **update-imports.js**：更新导入路径脚本

## 使用方法

1. 确保已安装所有依赖：

```bash
pnpm install
```

2. 执行重构脚本：

```bash
node scripts/restructure-project.js
```

3. 如果重构过程中出现问题，可以选择恢复备份：

```bash
# 脚本会自动询问是否恢复备份
```

## 注意事项

1. **备份**：重构脚本会自动备份当前项目，以便在出现问题时恢复
2. **渐进式重构**：重构过程采用渐进式策略，确保每个阶段都能正常运行
3. **向后兼容**：重构保持向后兼容，确保现有代码不会因为重构而失效
4. **测试**：重构后需要运行所有测试，确保功能正常

## 最佳实践

1. **组件命名**：使用 PascalCase 命名组件
2. **文件命名**：使用 kebab-case 命名文件
3. **类型命名**：使用 PascalCase 命名类型，接口名以 I 开头
4. **函数命名**：使用 camelCase 命名函数
5. **常量命名**：使用 UPPER_SNAKE_CASE 命名常量
6. **变量命名**：使用 camelCase 命名变量
7. **目录命名**：使用 kebab-case 命名目录

## 贡献指南

重构后，贡献新代码时请遵循以下规范：

1. **创建新组件**：
   - 在适当的目录下创建新的组件目录
   - 创建组件文件、类型文件和测试文件
   - 更新导出文件

2. **创建新钩子函数**：
   - 在适当的目录下创建新的钩子函数文件
   - 创建测试文件
   - 更新导出文件

3. **创建新工具函数**：
   - 在适当的目录下创建新的工具函数文件
   - 创建测试文件
   - 更新导出文件

4. **创建新类型定义**：
   - 在适当的目录下创建新的类型定义文件
   - 更新导出文件

## 常见问题

1. **重构后导入路径错误**：
   - 检查导入路径是否正确
   - 运行 `node scripts/update-imports.js` 更新导入路径

2. **重构后组件不显示**：
   - 检查组件是否正确导出
   - 检查导入路径是否正确

3. **重构后类型错误**：
   - 检查类型定义是否正确
   - 检查类型导入路径是否正确

## 联系方式

如有任何问题或建议，请联系项目维护者。
